# BLAKE2b AVX2ä¼˜åŒ–å¿«é€Ÿå‚è€ƒ

**ç ”ç©¶æ—¥æœŸ**: 2026-01-16  
**å·¥å…·**: MCP Deep Research + Braveæœç´¢  
**ç›®æ ‡**: 914 MB/s â†’ >1913 MB/s (2å€+)

---

## ğŸ¯ æ ¸å¿ƒå‘ç° (TL;DR)

### âš ï¸ å…³é”®è­¦å‘Š
**kctsbå½“å‰914 MB/så·²è¾¾åˆ°snevesæ‰‹å†™AVX2çš„æ€§èƒ½ (900-920 MB/s)ï¼**

**å¯èƒ½åŸå› **: ç¼–è¯‘å™¨å·²è‡ªåŠ¨å‘é‡åŒ– (`-march=native -O3`)

**å»ºè®®**: å…ˆéªŒè¯ç¼–è¯‘äº§ç‰©å†å†³å®šæ˜¯å¦æ‰‹å†™intrinsics

---

## ğŸ”¬ æŠ€æœ¯ç²¾é«“ (3ä¸ªå…³é”®ä¼˜åŒ–)

### 1ï¸âƒ£ æ—‹è½¬ä¼˜åŒ– (æœ€å¤§æ”¶ç›Šç‚¹)

```c
/* âŒ æ…¢ (3æ¡æŒ‡ä»¤) */
d = _mm256_or_si256(_mm256_srli_epi64(d, 32), _mm256_slli_epi64(d, 32));

/* âœ… å¿« (1æ¡æŒ‡ä»¤, 3xæ€§èƒ½) */
d = _mm256_shuffle_epi32(d, _MM_SHUFFLE(2,3,0,1));
```

**è¦ç‚¹**: 32ä½æ—‹è½¬ç”¨shuffle, 16ä½ç”¨vpshufb, 63ä½ç”¨`(x>>63)^(x+x)`

### 2ï¸âƒ£ æ¶ˆæ¯è°ƒåº¦ (é¿å…éšæœºè®¿é—®)

```c
/* âŒ ç ´åå‘é‡åŒ– */
a += m[sigma[r][i]];

/* âœ… é¢„å®šä¹‰96ä¸ªå® (12è½®Ã—8å®) */
#define BLAKE2B_LOAD_MSG_0_1(b0) do {                \
    __m256i t0 = _mm256_unpacklo_epi64(m0, m1);     \
    __m256i t1 = _mm256_unpacklo_epi64(m2, m3);     \
    b0 = _mm256_blend_epi32(t0, t1, 0xF0);          \
} while(0)
```

**è¦ç‚¹**: å…¨éƒ¨åœ¨å¯„å­˜å™¨å†…å®Œæˆ, é›¶å†…å­˜éšæœºè®¿é—®

### 3ï¸âƒ£ Gå‡½æ•°å‘é‡åŒ– (4-wayå¹¶è¡Œ)

```c
#define G1_AVX2(a, b, c, d, m0, m1) do {                 \
    a = _mm256_add_epi64(_mm256_add_epi64(a, m0), b);   \
    d = _mm256_xor_si256(d, a);                          \
    d = _mm256_shuffle_epi32(d, _MM_SHUFFLE(2,3,0,1));  \
    c = _mm256_add_epi64(c, d);                          \
    b = _mm256_xor_si256(b, c);                          \
    b = ROTR24_AVX2(b);                                  \
} while(0)
```

**è¦ç‚¹**: ä½¿ç”¨`_mm256_*`ä¸€æ¬¡å¤„ç†4ä¸ª64ä½æ“ä½œ

---

## ğŸ“Š æ€§èƒ½æ•°æ®éªŒè¯

| å®ç° | æ€§èƒ½ | å¹³å° |
|------|------|------|
| **kctsb portable** | **914 MB/s** | Intelæµ‹è¯•å¹³å° |
| sneves/blake2-avx2 | 900-920 MB/s | i5-8250U |
| minio/blake2b-simd | 918 MB/s | Xeon E5-2620 |

**ç»“è®º**: kctsbå·²è¾¾åˆ°å®˜æ–¹AVX2æ‰‹å†™ç‰ˆæœ¬çš„æ€§èƒ½ï¼

---

## ğŸš€ å®æ–½å†³ç­–æ ‘

```
START
  â†“
[æ£€æŸ¥ç¼–è¯‘é€‰é¡¹]
  â”œâ”€ ä½¿ç”¨-march=native? â”€â”€â”€â”€â†’ æ˜¯ â”€â”€â”
  â””â”€ å¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                    â†“
                            [æ£€æŸ¥æ±‡ç¼–ä»£ç ]
                              â”œâ”€ åŒ…å«vpaddq/vpshufd? â”€â†’ æ˜¯ â”€â”€â”
                              â””â”€ å¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â†“                                                           â†“
[å·²å‘é‡åŒ–]                                            [æœªå‘é‡åŒ–]
  â”œâ”€ æ‰‹å†™æ”¶ç›Š: 10-20%                                   â”œâ”€ å…ˆå°è¯•ç¼–è¯‘ä¼˜åŒ–
  â”œâ”€ ç»´æŠ¤æˆæœ¬: é«˜ (96ä¸ªå®)                              â”œâ”€ å¯èƒ½ç«‹å³2xåŠ é€Ÿ
  â””â”€ å»ºè®®: æš‚ä¸å®æ–½                                     â””â”€ å»ºè®®: ä¼˜å…ˆç¼–è¯‘æ ‡å¿—
      â†“                                                     â†“
      è€ƒè™‘å…¶ä»–æ–¹æ¡ˆ:                                        [é‡æ–°benchmark]
      - AVX-512 (8-way)                                        â†“
      - BLAKE2bp (å¤šçº¿ç¨‹)                                   è¾¾åˆ°900+ MB/s?
      - ç®—æ³•æ›¿æ¢ (BLAKE3)                                      â”œâ”€ æ˜¯ â†’ å®Œæˆ
                                                               â””â”€ å¦ â†’ è€ƒè™‘æ‰‹å†™AVX2
```

---

## ğŸ“ æ–‡æ¡£å¯¼èˆª

1. **[blake2b-avx2-research.md](blake2b-avx2-research.md)** - è¯¦ç»†æŠ€æœ¯åˆ†æ (æ¨èç²¾è¯»)
   - 4-wayå¹¶è¡ŒåŸç†
   - Gå‡½æ•°å®Œæ•´å®ç°
   - 96ä¸ªæ¶ˆæ¯è°ƒåº¦å®
   - æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

2. **[blake2b_avx2_reference.c](blake2b_avx2_reference.c)** - å¯é›†æˆä»£ç 
   - æ—‹è½¬ä¼˜åŒ–å®
   - G1/G2å®Œæ•´å®ç°
   - CPUç‰¹æ€§æ£€æµ‹
   - å‹ç¼©å‡½æ•°æ¡†æ¶

3. **[blake2b-avx2-summary.md](blake2b-avx2-summary.md)** - ç ”ç©¶æ€»ç»“
   - MCPå·¥å…·ä½¿ç”¨ç»éªŒ
   - æ€§èƒ½ç“¶é¢ˆåˆ†æ
   - å®æ–½è®¡åˆ’ (8.5å°æ—¶)
   - é‡è¦è­¦å‘Šä¸å»ºè®®

4. **[README.md](README.md)** - ä¼˜åŒ–æŒ‡å—ç´¢å¼•

---

## âš¡ å¿«é€ŸéªŒè¯å‘½ä»¤

```bash
# 1. æ£€æŸ¥å½“å‰ç¼–è¯‘é€‰é¡¹
grep -r "march=native" CMakeLists.txt

# 2. æŸ¥çœ‹æ±‡ç¼–ä»£ç  (å¯»æ‰¾AVX2æŒ‡ä»¤)
objdump -d build/libkctsb.a | grep -E "vpaddq|vpshufd|vpshufb|vpxor"

# 3. æ€§èƒ½åˆ†æ
perf stat -e cycles,instructions,cache-misses ./benchmark blake2b

# 4. CPUç‰¹æ€§æ£€æµ‹
lscpu | grep -E "avx2|avx512"
```

---

## ğŸ“ å…³é”®å‚è€ƒ

- **Samuel Nevesè®ºæ–‡**: [IACR 2012/275](https://eprint.iacr.org/2012/275)
- **å®˜æ–¹å®ç°**: [sneves/blake2-avx2](https://github.com/sneves/blake2-avx2)
- **IntelæŒ‡ä»¤é›†**: [Intrinsics Guide](https://www.intel.com/content/www/us/en/docs/intrinsics-guide/)

---

## ğŸ’¡ æœ€ç»ˆå»ºè®®

### å¦‚æœkctsbå·²è‡ªåŠ¨å‘é‡åŒ– (æœ€å¯èƒ½æƒ…å†µ):
- âœ… ä¿æŒç°çŠ¶, 914 MB/så·²æ˜¯ä¸šç•Œé¡¶å°–æ°´å¹³
- âœ… è€ƒè™‘AVX-512æˆ–å¤šçº¿ç¨‹çªç ´2000+ MB/s
- âŒ æ‰‹å†™96ä¸ªå®çš„ç»´æŠ¤æˆæœ¬ > 10-20%æ€§èƒ½æ”¶ç›Š

### å¦‚æœkctsbæœªå‘é‡åŒ–:
- âœ… å…ˆå°è¯•ç¼–è¯‘ä¼˜åŒ– (`-march=native -O3 -flto`)
- âœ… å¦‚ä»ä¸æ»¡è¶³, å‚è€ƒ[blake2b_avx2_reference.c](blake2b_avx2_reference.c)å®æ–½
- âœ… é¢„æœŸæ€§èƒ½: 2000-2300 MB/s

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-16  
**çŠ¶æ€**: ç ”ç©¶å®Œæˆ, ç­‰å¾…å®æ–½å†³ç­–

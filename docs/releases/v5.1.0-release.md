# v5.1.0 Release Notes

**发布日期**: 2026-01-26
**版本类型**: 架构优化版本

## 概述

v5.1.0 版本对 benchmark 子系统进行了完整重构，实现了主编译与 benchmark 的完全分离，提升了构建效率和灵活性。

## 主要变更

### 1. Benchmark 独立编译架构

**Before (v5.0.0)**:
```cmake
# 主 CMakeLists.txt
option(KCTSB_BUILD_BENCHMARKS "Build benchmarks" ON)
add_subdirectory(benchmarks)
```

**After (v5.1.0)**:
```cmake
# 主 CMakeLists.txt - 不再包含 benchmarks
# benchmarks/ 有独立的 CMakeLists.txt
```

### 2. 两种 Benchmark 类型

| 目录 | 目的 | 依赖 | 基线 |
|------|------|------|------|
| `benchmarks/` | 第三方库对比 | OpenSSL, SEAL, GmSSL | 实测对比 |
| `tests/benchmark/` | 单算法优化 | 仅 kctsb | 硬编码 |

### 3. benchmarks/ 目录结构

```
benchmarks/
├── CMakeLists.txt          # 独立 CMake 构建
├── AGENTS.md               # 开发约束文档
├── benchmark_common.hpp    # 通用工具函数
├── benchmark_main.cpp      # 主程序入口
├── benchmark_openssl.cpp   # vs OpenSSL 3.6.0
├── benchmark_seal.cpp      # vs SEAL 4.1.2
├── benchmark_gmssl.cpp     # vs GmSSL
└── benchmark_cuda.cpp      # CPU vs CUDA GPU
```

### 4. 命令行参数支持

```bash
./benchmark_suite all      # 全部对比
./benchmark_suite openssl  # vs OpenSSL
./benchmark_suite seal     # vs SEAL
./benchmark_suite gmssl    # vs GmSSL
./benchmark_suite cuda     # CPU vs GPU
```

## 构建说明

### 主项目构建 (不包含 benchmark)

```powershell
cd D:\pyproject\kctsb
cmake -B build -G Ninja -DKCTSB_BUILD_STATIC=ON
cmake --build build --parallel
```

### 第三方库对比 benchmark

```powershell
cd benchmarks
cmake -B build -G Ninja
cmake --build build --parallel
./build/bin/benchmark_suite all
```

### 单算法优化 benchmark

```powershell
cd tests/benchmark
cmake -B build -G Ninja
cmake --build build --parallel
./build/bin/test_ckks_benchmark
```

## 移除的选项

- `KCTSB_BUILD_BENCHMARKS` - 已移除，benchmark 使用独立编译
- `KCTSB_ENABLE_OPENSSL` - 已移除，OpenSSL 仅用于 benchmark 对比
- `KCTSB_ENABLE_SEAL` - 已移除，SEAL 仅用于 benchmark 对比
- `KCTSB_ENABLE_HELIB` - 已移除
- `KCTSB_ENABLE_NTL` - 已移除，v5.0 已使用原生 ZZ
- `KCTSB_ENABLE_GMP` - 已移除，v5.0 已使用原生 BigInt

## 依赖说明

### 主库 (v5.0+)
- **零外部依赖** - 完全自包含

### benchmarks/ (可选)
- OpenSSL 3.6.0 - 系统安装或 thirdparty/
- SEAL 4.1.2 - thirdparty/win-x64/lib/libseal-4.1.a
- GmSSL - 需要从 deps/gmssl/ 编译
- CUDA - build-cuda/kctsb_cuda.lib

## 兼容性

- **API 兼容**: 完全兼容 v5.0.0
- **ABI 兼容**: 完全兼容 v5.0.0
- **构建脚本**: 需要更新移除 `-DKCTSB_BUILD_BENCHMARKS` 参数

## 已知问题

1. GmSSL 需要手动从 deps/ 源码编译
2. CUDA benchmark 需要先构建 build-cuda/

## 升级指南

1. 更新构建脚本移除 `KCTSB_BUILD_BENCHMARKS` 选项
2. 如需 benchmark，单独进入 benchmarks/ 目录编译
3. 如需单算法测试，进入 tests/benchmark/ 目录编译

---

*Knight's Cryptographic Trusted Security Base - v5.1.0*

# kctsb v3.4.1 Release Notes

**Release Date**: 2026å¹´1æœˆ16æ—¥ï¼ˆåŒ—äº¬æ—¶é—´ Beijing/Shanghai UTC+8ï¼‰  
**Version**: 3.4.1 (Patch Release)  
**Type**: Maintenance & Optimization  

## Overview

v3.4.1ä¸“æ³¨äºä»£ç æ¸…ç†å’Œç¼–è¯‘å‚æ•°ä¼˜åŒ–ï¼Œå®Œå…¨ç§»é™¤BLAKE2sæ”¯æŒï¼Œç»Ÿä¸€Debug/Releaseæ„å»ºé…ç½®ä»¥ç¡®ä¿å¼€å‘é˜¶æ®µä¹Ÿèƒ½éªŒè¯æ€§èƒ½åŸºå‡†ã€‚

## Major Changes

### 1. BLAKE2s Support Removal âœ‚ï¸
- **ç§»é™¤å†…å®¹**: å®Œå…¨ç§»é™¤RFC 7693 BLAKE2så®ç°åŠæ‰€æœ‰ç›¸å…³å‡½æ•°
  - C API: `kctsb_blake2s_init`, `kctsb_blake2s_update`, `kctsb_blake2s_final`, `kctsb_blake2s`ç­‰6ä¸ªå‡½æ•°
  - C++ ç±»: `BLAKE2s` å‹ç¼©ç±»åŠIVå¸¸é‡
  - å¤´æ–‡ä»¶: `BLAKE2s_OUTBYTES`, `BLAKE2s_BLOCKBYTES`, `BLAKE2s_KEYBYTES` å¸¸é‡

- **æ›¿ä»£æ–¹æ¡ˆ**: ç”¨æˆ·åº”ä½¿ç”¨ `kctsb_blake2b_*` APIæ›¿ä»£
  - BLAKE2bæä¾›äº†æ›´å¼ºçš„å®‰å…¨æ€§å’Œç›¸ä¼¼çš„æ€§èƒ½
  - RFC 7693æ¨èBLAKE2bç”¨äºæ–°é¡¹ç›®

- **ä»£ç åˆ é™¤é‡**: 
  - blake2.h: -50è¡Œï¼ˆç±»å‹å®šä¹‰å’ŒC APIå£°æ˜ï¼‰
  - blake2.cpp: -168è¡Œï¼ˆå‹ç¼©ç±»ã€constantsã€C ABIå‡½æ•°ï¼‰
  - æµ‹è¯•: -60è¡Œï¼ˆBLAKE2s_Empty, BLAKE2s_ABC æµ‹è¯•ç”¨ä¾‹ï¼‰
  - åŸºå‡†: -20è¡Œï¼ˆBLAKE2såŸºå‡†å‡½æ•°ï¼‰

### 2. Unified Debug/Release Compilation Parameters ğŸ”§

**ç›®æ ‡**: ç¡®ä¿Debugå’ŒReleaseç‰ˆæœ¬ä½¿ç”¨ç›¸åŒçš„ä¼˜åŒ–å‚æ•°ï¼Œä½¿å¼€å‘æµ‹è¯•èƒ½å¤ŸéªŒè¯æ€§èƒ½åŸºå‡†

**æ”¹åŠ¨**:
```cmake
# ä¹‹å‰: Release-onlyä¼˜åŒ–
if(CMAKE_BUILD_TYPE STREQUAL "Release")
    # -O3, -march=native, -fltoç­‰æ ‡å¿—åªåœ¨Releaseä¸­åº”ç”¨
endif()

# ç°åœ¨: æ‰€æœ‰æ„å»ºç±»å‹ç»Ÿä¸€åº”ç”¨
# Debugå’ŒReleaseéƒ½ä½¿ç”¨ç›¸åŒçš„ä¼˜åŒ–å‚æ•°ï¼š
# -O3 -march=native -mtune=native -ffast-math -funroll-loops 
# -fomit-frame-pointer -fstack-protector-strong -flto
```

**ä¼˜åŠ¿**:
- âœ… Debugæ„å»ºå¯ä»¥å‡†ç¡®éªŒè¯å“ˆå¸Œæ€§èƒ½åŸºå‡†
- âœ… å¼€å‘é˜¶æ®µå‘ç°æ€§èƒ½å›é€€
- âœ… å•å…ƒæµ‹è¯•ä¸ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç›¸åŒä¼˜åŒ–çº§åˆ«
- âœ… ç¼–è¯‘æ—¶é—´å¢åŠ ï¼ˆä½¿ç”¨LTOï¼‰ï¼Œä½†æ€§èƒ½æµ‹è¯•æ›´å‡†ç¡®

**Benchmarkç­–ç•¥**:
- Debugå’ŒRelease: éƒ½æ‰§è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- Release only: è¿è¡Œæ€§èƒ½åŸºå‡†ï¼ˆkctsb_benchmarkï¼‰

## Performance Impact

### Hash Functions Benchmark (Debug Build with -O3, -march=native, -flto)

æµ‹è¯•é…ç½®ï¼š
- æ•°æ®å¤§å°: 1KB, 64KB, 1MB, 10MB
- è¿­ä»£æ¬¡æ•°: 100æ¬¡ï¼ˆé¢„çƒ­10æ¬¡ï¼‰
- å¯¹æ ‡åº“: OpenSSL 3.6.0 

#### è¯¦ç»†ç»“æœï¼š

**SHA-256**
| æ•°æ®å¤§å° | kctsbååé‡ | OpenSSLååé‡ | ç›¸å¯¹æ€§èƒ½ | å¤‡æ³¨ |
|---------|-----------|-----------|--------|------|
| 1KB     | 1493 MB/s | 967 MB/s  | +54% âœ… | ä¼˜äºOpenSSL |
| 64KB    | 1944 MB/s | 2010 MB/s | -3%   | æ¥è¿‘ |
| 1MB     | 1869 MB/s | 1982 MB/s | -6%   | æ¥è¿‘ |
| 10MB    | 1943 MB/s | 2075 MB/s | -7%   | æ¥è¿‘ |

**SHA3-256** (é‡ç‚¹ç›‘æ§)
| æ•°æ®å¤§å° | kctsbååé‡ | OpenSSLååé‡ | ç›¸å¯¹æ€§èƒ½ |
|---------|-----------|-----------|--------|
| 1KB     | 469 MB/s  | 417 MB/s  | +13% âœ… |
| 64KB    | 523 MB/s  | 574 MB/s  | -9%   |
| 1MB     | 490 MB/s  | 525 MB/s  | -7%   |
| 10MB    | 495 MB/s  | 535 MB/s  | -7%   |

**åˆ†æ**: SHA3-256å¹³å‡ååé‡çº¦500MB/sï¼Œæœªè¾¾åˆ°567MB/sç›®æ ‡ï¼ˆ-12%ï¼‰ã€‚å»ºè®®åç»­ä¼˜åŒ–permute()å¯„å­˜å™¨å¸ƒå±€ã€‚

**BLAKE2b-512** (AVX2è‡ªåŠ¨å‘é‡åŒ–)
| æ•°æ®å¤§å° | kctsbååé‡ | OpenSSLååé‡ | ç›¸å¯¹æ€§èƒ½ |
|---------|-----------|-----------|--------|
| 1KB     | 687 MB/s  | 478 MB/s  | +44% âœ… |
| 64KB    | 685 MB/s  | 650 MB/s  | +5%  |
| 1MB     | 963 MB/s  | 665 MB/s  | +45% âœ… |
| 10MB    | 932 MB/s  | 705 MB/s  | +30% âœ… |

**åˆ†æ**: BLAKE2bæ€§èƒ½ä¼˜å¼‚ï¼Œå¤§æ•°æ®å—è¶…è¿‡OpenSSL 30-45%ã€‚AVX2è‡ªåŠ¨å‘é‡åŒ–æœ‰æ•ˆã€‚

## Breaking Changes âš ï¸

### API Changes
```c
// âŒ ä»¥ä¸‹å‡½æ•°å·²ç§»é™¤ï¼Œä¸å†å¯ç”¨:
kctsb_blake2s_init()
kctsb_blake2s_init_key()
kctsb_blake2s_update()
kctsb_blake2s_final()
kctsb_blake2s()
kctsb_blake2s_clear()

// âŒ ä»¥ä¸‹ç±»å‹å®šä¹‰å·²ç§»é™¤:
kctsb_blake2s_ctx_t
```

### Header Changes
```c
// âŒ ä»¥ä¸‹å¸¸é‡å·²ç§»é™¤:
KCTSB_BLAKE2S_OUTBYTES    // = 32
KCTSB_BLAKE2S_BLOCKBYTES  // = 64
KCTSB_BLAKE2S_KEYBYTES    // = 32
```

### Migration Guide

å¦‚æœæ‚¨çš„ä»£ç ä½¿ç”¨BLAKE2sï¼Œè¯·æŒ‰ä»¥ä¸‹æ–¹å¼å‡çº§ï¼š

```c
// æ—§ä»£ç ï¼ˆä¸å†æ”¯æŒï¼‰
kctsb_blake2s_ctx_t ctx;
kctsb_blake2s_init(&ctx, 32);
kctsb_blake2s_update(&ctx, data, len);
kctsb_blake2s_final(&ctx, digest);

// æ–°ä»£ç ï¼ˆä½¿ç”¨BLAKE2bï¼‰
kctsb_blake2b_ctx_t ctx;
kctsb_blake2b_init(&ctx, 32);           // BLAKE2bè¾“å‡ºå¤§å°: 32/48/64
kctsb_blake2b_update(&ctx, data, len);
kctsb_blake2b_final(&ctx, digest);
```

## Testing & Validation

âœ… **å•å…ƒæµ‹è¯•**: 152/152æµ‹è¯•é€šè¿‡
- æ‰€æœ‰Hashç®—æ³•æµ‹è¯•é€šè¿‡
- BLAKE2sç›¸å…³æµ‹è¯•å·²ç§»é™¤ï¼Œä¸å½±å“BLAKE2bæµ‹è¯•
- é›†æˆæµ‹è¯•é€šè¿‡

âœ… **ç¼–è¯‘éªŒè¯**:
- MinGW-w64 GCC 13+ ç¼–è¯‘æˆåŠŸï¼ˆ0ä¸ªé”™è¯¯ï¼‰
- Debugç‰ˆæœ¬ç¼–è¯‘æ—¶é—´: ~120ç§’ï¼ˆå«LTOï¼‰
- æ— BLAKE2sç›¸å…³ç¼–è¯‘é”™è¯¯æˆ–è­¦å‘Š

âœ… **SHA-256 SIMDä¼˜åŒ–ä¿®å¤** (v3.4.1ä¿®å¤):
- ä¿®å¤19ä¸ªç¼–è¯‘è­¦å‘Šï¼ˆç¬¬149è¡Œæœªä½¿ç”¨å˜é‡ + 16ä¸ªç¬¦å·è½¬æ¢è­¦å‘Šï¼‰
- æ ‡è®°t1/t2ä¸º`[[maybe_unused]]`ï¼ˆåœ¨æ ‡é‡å®ç°ä¸­ç”¨äºä»£ç å®Œæ•´æ€§ï¼‰
- æ‰€æœ‰_mm_set_epi64x()è°ƒç”¨ä½¿ç”¨`static_cast<int64_t>()`åŒ…è£…ULLå¸¸é‡
- SHA-256 SHA-NIåŠ é€Ÿå™¨å®ç°ç¼–è¯‘é€šè¿‡ï¼Œ-Werroræ— å·®é”™

âœ… **åŸºå‡†æµ‹è¯•**: Hashä¸“é¡¹åŸºå‡†å®Œæˆ
- ç§»é™¤äº†BLAKE2såŸºå‡†å‡½æ•°
- æ–°çš„åŸºå‡†æŠ¥å‘Šä»…åŒ…å«BLAKE2b

## Build Information

### Compiler & Flags
```bash
Compiler: MinGW-w64 GCC 15.2.0
C++ Standard: C++17
Compilation Flags (Debug & Release):
  -O3 -march=native -mtune=native -ffast-math -funroll-loops 
  -fomit-frame-pointer -fstack-protector-strong -fPIC -flto
Hardware: AES-NI, PCLMUL, SSE4.2, SSSE3, AVX2, BMI2, SHA-NI
```

### Build Instructions

```powershell
# Debugç‰ˆæœ¬ï¼ˆå«å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ï¼‰
cd D:\pyproject\kctsb
cmake -B build_debug -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Debug
cd build_debug && mingw32-make -j4

# Releaseç‰ˆæœ¬ï¼ˆä»…åŸºå‡†ï¼Œé€‚ç”¨äºæ€§èƒ½åˆ†æï¼‰
cmake -B build_release -G "Ninja" -DCMAKE_BUILD_TYPE=Release
cd build_release && ninja

# è¿è¡ŒHashåŸºå‡†
.\build_release\bin\kctsb_benchmark.exe hash
```

## Files Modified

- `CMakeLists.txt` (+40, -0): ç»Ÿä¸€Debug/Releaseç¼–è¯‘å‚æ•°
- `include/kctsb/crypto/blake2.h` (-50): ç§»é™¤BLAKE2så£°æ˜
- `src/crypto/blake2.cpp` (-168): ç§»é™¤BLAKE2så®ç°
- `src/crypto/sha256.cpp` (+32, -0): SHA-256 SIMDç¼–è¯‘ä¿®å¤ âœ…
- `benchmarks/benchmark_hash.cpp` (-20): ç§»é™¤BLAKE2såŸºå‡†å‡½æ•°
- `tests/unit/crypto/test_hash.cpp` (-60): ç§»é™¤BLAKE2så•å…ƒæµ‹è¯•
- `README.md` (Â±10): æ›´æ–°æ–‡æ¡£å¼•ç”¨

**æ€»è®¡**: +72, -298è¡Œä»£ç 

### SHA-256 SIMDç¼–è¯‘ä¿®å¤è¯¦æƒ…

**é—®é¢˜æè¿°**:
- è¡Œ149: å˜é‡`t1`, `t2`åœ¨`transform_scalar()`ä¸­æœªä½¿ç”¨ï¼ˆscalarå®ç°ä¸ºå®Œæ•´æ€§ä¿ç•™ï¼‰
- è¡Œ214, 222, 230, 238, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 349, 358: 16ä¸ªç¬¦å·è½¬æ¢è­¦å‘Š
  - `_mm_set_epi64x()`æœŸæœ›`int64_t`å‚æ•°ï¼Œä½†ä¼ å…¥`uint64_t` (ULLåç¼€)
  - ç¼–è¯‘å™¨(-Werror)å°†æ‰€æœ‰è­¦å‘Šè½¬ä¸ºé”™è¯¯ï¼Œé˜»æ–­æ„å»º

**ä¿®å¤æ–¹æ¡ˆ**:
1. ç¬¬149è¡Œ: ä½¿ç”¨C++17å±æ€§`[[maybe_unused]]`æ ‡è®°t1å’Œt2
   ```cpp
   // ä¿®å¤å‰:
   uint32_t t1, t2;
   
   // ä¿®å¤å:
   uint32_t t1 [[maybe_unused]], t2 [[maybe_unused]];
   ```

2. æ‰€æœ‰_mm_set_epi64x()è°ƒç”¨: åŒ…è£…ULLå¸¸é‡ä¸º`static_cast<int64_t>()`
   ```cpp
   // ä¿®å¤å‰:
   MSG = _mm_add_epi32(MSG0, _mm_set_epi64x(0xE9B5DBA5B5C0FBCFULL, 0x71374491428A2F98ULL));
   
   // ä¿®å¤å:
   MSG = _mm_add_epi32(MSG0, _mm_set_epi64x(
       static_cast<int64_t>(0xE9B5DBA5B5C0FBCFULL), 
       static_cast<int64_t>(0x71374491428A2F98ULL)
   ));
   ```

**ä¿®å¤ç»“æœ**:
- âœ… 1ä¸ªæœªä½¿ç”¨å˜é‡è­¦å‘Š â†’ è§£å†³
- âœ… 16ä¸ªç¬¦å·è½¬æ¢è­¦å‘Š â†’ è§£å†³
- âœ… ç¼–è¯‘é€šè¿‡(-Werror)ï¼Œæ— å·®é”™
- âœ… SHA-256 SHA-NIåŠ é€Ÿå™¨è¿è¡Œæ­£å¸¸

## Known Issues & Future Work

### SHA3-256 Performance Gap ğŸ¯
- **é—®é¢˜**: SHA3-256ååé‡çº¦500MB/sï¼Œä½äº567MB/sç›®æ ‡ï¼ˆ-12%ï¼‰
- **æ ¹å› **: Keccak permute()å¯èƒ½å­˜åœ¨å¯„å­˜å™¨åˆ†é…ä¸ä¼˜
- **è®¡åˆ’**: v3.5.0ä¸­å®ç°permute()å¯„å­˜å™¨å¸ƒå±€ä¼˜åŒ–ï¼ˆfast-path consolidationæ”¹è¿›ï¼‰

### OTP Module Build Warnings âš ï¸
- Releaseæ„å»ºå› ä¸º`-Werror=conversion`å¯¼è‡´OTPæ¨¡å—æŸäº›ç±»å‹è½¬æ¢è­¦å‘Šè½¬ä¸ºé”™è¯¯
- è®¡åˆ’åœ¨v3.4.2ä¸­ä¿®å¤OTPæ¨¡å—ç±»å‹è½¬æ¢è­¦å‘Š
- Debug/Releaseéƒ½ä½¿ç”¨-O3ä¸å½±å“åŠŸèƒ½ï¼Œä»…å½±å“OTPæ¨¡å—çš„Releaseæ„å»º

## Version Compatibility

| Component | v3.4.0 | v3.4.1 | å…¼å®¹æ€§ |
|-----------|--------|--------|------|
| AES-GCM   | âœ…     | âœ…     | å…¼å®¹  |
| ChaCha20  | âœ…     | âœ…     | å…¼å®¹  |
| SHA-2/3   | âœ…     | âœ…     | å…¼å®¹  |
| BLAKE2b   | âœ…     | âœ…     | å…¼å®¹  |
| **BLAKE2s** | âœ…   | âŒ å·²ç§»é™¤ | ä¸å…¼å®¹ âš ï¸ |
| SM2/3/4   | âœ…     | âœ…     | å…¼å®¹  |
| ECC/RSA   | âœ…     | âœ…     | å…¼å®¹  |

## References

- [RFC 7693 - BLAKE2](https://tools.ietf.org/html/rfc7693) - BLAKE2bæ¨èç”¨äºæ–°é¡¹ç›®
- [NIST FIPS 202 - SHA-3](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf)
- [Optimization Documentation](../optimization/) - è¯¦è§ä¼˜åŒ–æŒ‡å—

## Contributors & Acknowledgments

æ„Ÿè°¢è´¡çŒ®è€…å¯¹kctsbé¡¹ç›®çš„æŒç»­æ”¯æŒã€‚æ­¤ç‰ˆæœ¬é‡ç‚¹å…³æ³¨ä»£ç è´¨é‡å’Œæ„å»ºé…ç½®çš„ä¸€è‡´æ€§ã€‚

---

**Release Manager**: kn1ghtc  
**Quality Assurance**: 152/152å•å…ƒæµ‹è¯•é€šè¿‡  
**Documentation**: å®Œæ•´æ›´æ–°  

ä¸‹ä¸€ä¸ªç‰ˆæœ¬ (v3.5.0) é¢„è®¡å°†ä¸“æ³¨äºSHA3-256æ€§èƒ½ä¼˜åŒ–å’Œæ€§èƒ½CIé›†æˆã€‚

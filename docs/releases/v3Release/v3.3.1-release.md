# kctsb v3.3.1 Release Notes

**发布日期**: 2025-01-20 (UTC+8 北京时间)

## 📋 版本摘要

代码重构版本，实现"单算法单文件闭环"模式，删除冗余文件，统一算法实现架构。

## ✨ 主要变更

### 代码重构 - 单文件闭环模式

本版本按照重构原则"单个算法在单个文件内闭环，公共代码则引用utils目录的子文件实现"进行了以下文件合并：

1. **RSA 模块清理**
   - 删除 `rsaUtil.cpp` 和 `rsa_util.hpp`
   - RSA 功能完全整合到 `rsa.cpp`

2. **Keccak/SHA3 合并**
   - `keccak_avx2.cpp` 合并到 `Keccak.cpp`
   - 保留 AVX2 优化，运行时自动检测

3. **SHA-256 重写**
   - `sha256.c` 和 `sha256_shani.cpp` 合并到 `sha256.cpp` (C++ 重写)
   - SHA-NI 硬件加速暂时禁用（待修复内存对齐问题）
   - 软件实现完全可用

4. **AES 合并**
   - `aes.cpp` 和 `aes_ttable.cpp` 合并
   - AES-NI 用于 AES-128（最快，timing-safe）
   - 软件实现用于 AES-192/256（constant-time）
   - T-table 代码保留供未来优化使用

### 架构改进

- 统一加密/解密格式兼容性
- 简化 CMakeLists.txt 构建配置
- 优化头文件包含关系

## 🧪 测试状态

```
100% tests passed, 0 tests failed out of 91

测试覆盖:
- AES-128/192/256: 14 tests ✅
- SHA-256/SHA3: 8 tests ✅  
- Keccak: 6 tests ✅
- RSA: 10 tests ✅
- ECC/ECDSA: 12 tests ✅
- PQC (Kyber/Dilithium): 8 tests ✅
- zk-SNARKs: 6 tests ✅
- 其他: 27 tests ✅
```

## 📁 文件变更

### 删除的文件
- `include/kctsb/crypto/rsa/rsa_util.hpp`
- `src/crypto/rsa/rsaUtil.cpp`
- `src/crypto/hash/keccak_avx2.cpp`
- `src/crypto/hash/sha256.c`
- `src/crypto/hash/sha256_shani.cpp`
- `src/crypto/aes/aes_ttable.cpp`

### 新增的文件
- `src/crypto/hash/sha256.cpp` (C++ 重写)

### 修改的文件
- `src/crypto/aes/aes.cpp` (合并 T-table)
- `src/crypto/hash/Keccak.cpp` (合并 AVX2)
- `CMakeLists.txt` (更新构建配置)

## ⚠️ 已知问题

1. **SHA-NI 暂时禁用**: SHA-256 的 SHA-NI 硬件加速因内存对齐问题暂时禁用，将在后续版本修复。软件实现完全可用且性能足够。

## 🔄 升级指南

从 v3.3.0 升级：
1. 无 API 变更，直接重新编译即可
2. 如有自定义 CMakeLists.txt，需更新源文件列表

## 📊 性能

| 算法 | 旧版本 | 新版本 | 变化 |
|------|--------|--------|------|
| AES-128 (AES-NI) | 2.1 GB/s | 2.1 GB/s | 无变化 |
| AES-192 (软件) | - | 450 MB/s | 新实现 |
| AES-256 (软件) | - | 380 MB/s | 新实现 |
| SHA-256 | 1.8 GB/s | 1.2 GB/s | SHA-NI 禁用 |
| Keccak/SHA3 | 1.5 GB/s | 1.5 GB/s | 无变化 |

## 构建环境

- **编译器**: MinGW-w64 GCC 13.2.0
- **CMake**: 3.28+
- **平台**: Windows 11 x64
- **依赖**: GMP 6.3.0, NTL 11.6.0, SEAL 4.1.2

---

**完整变更日志**: [GitHub Commits](https://github.com/knightc/kctsb/compare/v3.3.0...v3.3.1)

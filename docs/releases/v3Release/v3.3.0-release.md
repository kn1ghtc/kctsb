# kctsb v3.3.0 Release Notes

> **Release Date**: 2026-01-14 (Beijing Time, UTC+8)
> **Version**: 3.3.0
> **Codename**: "SIMD Thunder"

---

## üéØ Release Highlights

This release focuses on **performance optimization** through SIMD hardware acceleration and comprehensive testing improvements. Based on benchmark analysis against OpenSSL 3.3, targeted optimizations achieve significant performance gains.

### Key Changes

1. **SHA-NI Hardware Acceleration** - SHA-256 using Intel SHA Extensions
2. **AVX2 Keccak Optimization** - SHA3-256 with vectorized permutation
3. **AES-NI Integration Fix** - Runtime detection and format flag support
4. **Comprehensive SIMD Tests** - 15 new test cases for optimized paths
5. **92 Total Tests** - 100% pass rate across all modules

---

## ‚ú® Performance Improvements

### Benchmark Results (vs v3.2.0)

| Algorithm | v3.2.0 | v3.3.0 | Improvement |
|-----------|--------|--------|-------------|
| AES-128-GCM | ~2800 MB/s | **4666 MB/s** | +67% |
| SHA-256 | Scalar | **SHA-NI** | Hardware acceleration |
| SHA3-256 | Scalar | **AVX2** | Vectorized permutation |

### SIMD Feature Detection

Runtime CPUID-based feature detection ensures optimal code paths:

```cpp
#include <kctsb/simd/simd.h>

// Check available features
if (kctsb::simd::has_feature(kctsb::simd::SIMDFeature::SHA_NI)) {
    // Use SHA-NI accelerated path
}
if (kctsb::simd::has_feature(kctsb::simd::SIMDFeature::AVX2)) {
    // Use AVX2 optimized path
}
if (kctsb::simd::has_feature(kctsb::simd::SIMDFeature::AES_NI)) {
    // Use AES-NI hardware encryption
}
```

---

## üîß Technical Changes

### SHA-256 with SHA-NI (`src/crypto/hash/sha256_shani.cpp`)

New hardware-accelerated SHA-256 implementation using Intel SHA Extensions:

- **Parallel rounds**: Process two rounds at once using `sha256rnds2`
- **Message scheduling**: Vectorized with `sha256msg1`/`sha256msg2`
- **Automatic fallback**: Falls back to scalar when SHA-NI unavailable

```cpp
// C API
kctsb_sha256_shani(data, len, hash);
kctsb_sha256_shani_available(); // Check hardware support
```

### SHA3-256 with AVX2 (`src/crypto/hash/keccak_avx2.cpp`)

Vectorized Keccak-f[1600] permutation:

- **Œ∏ step**: Parallel column parity computation
- **œÅ/œÄ steps**: Correct rotation offsets per FIPS 202
- **œá step**: Row-wise non-linear transformation
- **Œπ step**: Round constant XOR

```cpp
// C API
kctsb_sha3_256_avx2(data, len, hash);
kctsb_sha3_256_avx2_available(); // Check AVX2 support
```

### AES-NI Integration Fix (`src/crypto/aes/aes.cpp`)

Fixed AES-NI runtime detection and key format handling:

- **Runtime detection**: `check_aesni()` now uses `kctsb::simd::has_aesni()`
- **Format flag**: `AESNI_FORMAT_FLAG = 0x10000` tracks key expansion format
- **Transparent fallback**: Decryption regenerates software keys if needed

```cpp
// Unified API - automatically uses AES-NI when available
kctsb_aes_init(&ctx, key, KCTSB_AES_128);
kctsb_aes_encrypt_block(&ctx, plaintext, ciphertext);
kctsb_aes_decrypt_block(&ctx, ciphertext, plaintext);
```

---

## üß™ Test Coverage

### New Test Suite (`tests/unit/crypto/test_simd_hash.cpp`)

15 new test cases covering SIMD optimization paths:

| Test Class | Tests | Coverage |
|------------|-------|----------|
| SHA256SIMDTest | 5 | SHA-NI/scalar consistency |
| SHA3SIMDTest | 5 | AVX2/scalar consistency |
| AESNIIntegrationTest | 3 | AES-NI encryption/GCM/CTR |
| SIMDFeatureTest | 2 | CPUID detection |

### Total Test Results

```
100% tests passed, 0 tests failed out of 92

Label Time Summary:
integration    =   0.28 sec*proc (4 tests)
performance    =   0.07 sec*proc (1 test)
unit           =   6.42 sec*proc (87 tests)
```

---

## üì¶ Build Artifacts

### Library Files

| File | Size | Description |
|------|------|-------------|
| `libkctsb.a` | 1.24 MB | Static library |
| `libkctsb.dll` | 3.92 MB | Dynamic library |
| `kctsb.exe` | 233 KB | CLI tool |

### CLI Usage

```powershell
# Version
kctsb.exe version

# Hash file with SHA3-256
kctsb.exe hash -algorithm sha3-256 -in document.pdf

# Supported algorithms
# sha256, sha3-256, blake2b
```

---

## üîÑ Migration Guide

### From v3.2.0

No breaking API changes. Upgrade is transparent:

1. Replace library files
2. Rebuild dependent projects
3. Performance improvements are automatic

### SIMD Feature Checking (Optional)

For applications that want to report hardware features:

```cpp
#include <kctsb/simd/simd.h>

void print_simd_features() {
    std::cout << "AES-NI: " << (has_aesni() ? "Yes" : "No") << "\n";
    std::cout << "SHA-NI: " << (has_feature(SIMDFeature::SHA_NI) ? "Yes" : "No") << "\n";
    std::cout << "AVX2: " << (has_feature(SIMDFeature::AVX2) ? "Yes" : "No") << "\n";
    std::cout << "AVX-512: " << (has_feature(SIMDFeature::AVX512F) ? "Yes" : "No") << "\n";
}
```

---

## üìã Dependencies

| Dependency | Version | Notes |
|------------|---------|-------|
| NTL | 11.6.0 | Number Theory Library |
| GMP | 6.3.0 | GNU Multiple Precision |
| SEAL | 4.1.2 | Homomorphic Encryption (optional) |
| HElib | v2.3.0 | FHE Library (optional) |
| GoogleTest | 1.15.2 | Testing (FetchContent) |

---

## üêõ Bug Fixes

1. **AES-NI detection**: Fixed stub `check_aesni()` that always returned false
2. **Keccak AVX2**: Corrected œÅ step rotation offsets for FIPS 202 compliance
3. **SHA3 empty input**: Allow null data pointer when length is 0
4. **Version test**: Updated integration test for v3.3.0

---

## üìö Documentation

- [API Reference](../examples/README.md)
- [Benchmark Analysis](../benchmark-analysis/)
- [Build Instructions](../../README.md#building)

---

## üôè Acknowledgments

- Intel for SHA-NI and AES-NI instruction sets
- NIST FIPS 202 specification for Keccak reference
- OpenSSL project for benchmark comparison baseline

---

**Full Changelog**: [v3.2.0...v3.3.0](https://github.com/knightc/kctsb/compare/v3.2.0...v3.3.0)

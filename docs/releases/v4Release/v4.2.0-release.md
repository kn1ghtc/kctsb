# kctsb v4.2.0 Release Notes

**Release Date**: 2026å¹´1æœˆ26æ—¥ (UTC+8)  
**Codename**: FHE Native + ECC Optimization  

---

## ğŸ¯ ç‰ˆæœ¬æ¦‚è¿°

v4.2.0 ä¸“æ³¨äºä¸¤ä¸ªæ ¸å¿ƒæ”¹è¿›ï¼š

1. **åŸç”ŸBGVå…¨åŒæ€åŠ å¯†** - åŸºäºkctsb bignumå®ç°çš„BGVæ–¹æ¡ˆï¼ˆå¼€å‘ä¸­ï¼‰
2. **ECC wNAFæ ‡é‡ä¹˜æ³•ä¼˜åŒ–** - ä½¿ç”¨w=5çª—å£çš„éç›¸é‚»è¡¨ç¤ºæ³•åŠ é€Ÿæ¤­åœ†æ›²çº¿è¿ç®—

æ­¤ç‰ˆæœ¬è¿˜æ”¹è¿›äº†æ„å»ºç³»ç»Ÿï¼Œæ·»åŠ äº†ä¾èµ–ç¼“å­˜æœºåˆ¶ä»¥é¿å…é‡å¤å¤åˆ¶ã€‚

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. åŸç”ŸBGVå…¨åŒæ€åŠ å¯†æ¡†æ¶ (KCTSB_ENABLE_BGV=ON)

å®Œæ•´çš„BGV (Brakerski-Gentry-Vaikuntanathan) åŒæ€åŠ å¯†å®ç°ï¼Œæ— éœ€HElibå¤–éƒ¨ä¾èµ–ï¼š

**æ ¸å¿ƒç»„ä»¶**:
- `bgv_types.hpp` - å®‰å…¨çº§åˆ«å®šä¹‰ã€å‚æ•°ç»“æ„ã€RingElementç±»
- `bgv_context.hpp/cpp` - å¯†é’¥ç”Ÿæˆã€åŠ å¯†ã€è§£å¯†
- `bgv_evaluator.hpp/cpp` - åŒæ€è¿ç®—ï¼ˆåŠ æ³•ã€ä¹˜æ³•ã€é‡çº¿æ€§åŒ–ã€æ—‹è½¬ï¼‰
- `bgv_encoder.hpp/cpp` - æ˜æ–‡ç¼–ç ï¼ˆæ•´æ•°ã€æ‰¹å¤„ç†SIMDï¼‰

**æ”¯æŒçš„æ“ä½œ**:
- åŒæ€åŠ æ³•/å‡æ³•ï¼ˆå¯†æ–‡-å¯†æ–‡ã€å¯†æ–‡-æ˜æ–‡ï¼‰
- åŒæ€ä¹˜æ³•ï¼ˆå«é‡çº¿æ€§åŒ–ï¼‰
- SIMDæ‰¹å¤„ç†ç¼–ç 
- æ¨¡æ•°åˆ‡æ¢é™å™ª
- Galoisæ—‹è½¬

**å®‰å…¨çº§åˆ«**:
- `CLASSICAL_128/192/256` - ç»å…¸å®‰å…¨
- `QUANTUM_128/192/256` - åé‡å­å®‰å…¨

**çŠ¶æ€**: å¼€å‘ä¸­ - éœ€è¦ä¿®å¤kctsb bignum APIå…¼å®¹æ€§åå¯ç”¨

### 2. ECC wNAFæ ‡é‡ä¹˜æ³•ä¼˜åŒ– âœ… å·²å®Œæˆ

wNAFä¼˜åŒ–å·²ç›´æ¥é›†æˆåˆ°æ ¸å¿ƒ`ecc_curve.cpp`ä¸­ï¼Œæ— éœ€ç‹¬ç«‹æ–‡ä»¶ï¼š

```cpp
// src/crypto/ecc/ecc_curve.cpp - å†…è”wNAFå®ç°

// wNAFç¼–ç  - å°†æ ‡é‡è½¬æ¢ä¸ºéç›¸é‚»è¡¨ç¤º (w=5)
size_t ECCurve::compute_wnaf(const ZZ& k, std::vector<int8_t>& wnaf) const;

// é¢„è®¡ç®—è¡¨ - å­˜å‚¨ P, 3P, 5P, ..., 15P (WNAF_TABLE_SIZE=16)
void ECCurve::build_precomp_table(const JacobianPoint& P,
                                   std::array<JacobianPoint, 16>& table) const;

// ä¼˜åŒ–çš„æ ‡é‡ä¹˜æ³• - æ›¿æ¢Montgomery ladderä½œä¸ºé»˜è®¤å®ç°
JacobianPoint ECCurve::wnaf_scalar_mult(const ZZ& k, const JacobianPoint& P) const;
JacobianPoint ECCurve::scalar_mult(const ZZ& k, const JacobianPoint& P) const;     // è°ƒç”¨wnaf
JacobianPoint ECCurve::scalar_mult_base(const ZZ& k) const;                         // è°ƒç”¨wnaf
```

**å®æµ‹æ€§èƒ½æå‡** (vs OpenSSL 3.6.0):
| æ“ä½œ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ | vs OpenSSL |
|------|--------|--------|------|------------|
| SM2 KeyGen | 1.9ms | 0.96ms | **~2x** | 29% |
| SM2 Sign | 2.0ms | 0.98ms | **~2x** | 28% |
| SM2 Verify | 2.3ms | 1.39ms | **~1.7x** | 18% |
| SM2 Encrypt | - | 1.95ms | - | 28% |
| SM2 Decrypt | - | 0.96ms | - | 28% |

**æ¶æ„ä¼˜åŠ¿**:
- æ— ç‹¬ç«‹ä¼˜åŒ–æ–‡ä»¶ï¼Œæ‰€æœ‰ä»£ç åœ¨å•ä¸€`ecc_curve.cpp`ä¸­
- Montgomery ladderä¿ç•™ä½œä¸ºåå¤‡ï¼ˆå¸¸é‡æ—¶é—´ä¿è¯ï¼‰
- 169/169 æµ‹è¯•é€šè¿‡ï¼ŒåŒ…æ‹¬22ä¸ªSMç³»åˆ—æµ‹è¯•

### 3. GLVåˆ†è§£ï¼ˆsecp256k1ï¼‰

é’ˆå¯¹secp256k1æ›²çº¿çš„é«˜æ•ˆè‡ªåŒæ€ä¼˜åŒ–ï¼š

```cpp
// GLV endomorphism: Ï†(x,y) = (Î²x, y) where Î²^3 = 1 mod p
std::pair<ZZ, ZZ> glv_decomposition(const ZZ& k, const ZZ& n);
JacobianPoint glv_scalar_mult(const ECCurve& curve, 
                              const JacobianPoint& P,
                              const ZZ& k);
```

---

## ğŸ”§ æ„å»ºç³»ç»Ÿæ”¹è¿›

### ä¾èµ–ç¼“å­˜æœºåˆ¶

ä¿®æ”¹CMakeLists.txtï¼Œä½¿ç”¨`copy_if_different`é¿å…é‡å¤å¤åˆ¶DLLï¼š

```cmake
# Before (æ¯æ¬¡æ„å»ºéƒ½å¤åˆ¶):
add_custom_command(... POST_BUILD COMMAND ${CMAKE_COMMAND} -E copy ...)

# After (ä»…åœ¨æ–‡ä»¶æ”¹å˜æ—¶å¤åˆ¶):
add_custom_command(... POST_BUILD 
    COMMAND ${CMAKE_COMMAND} -E copy_if_different ...)
```

### æ–°å¢CMakeé€‰é¡¹

```cmake
option(KCTSB_ENABLE_BGV "Enable native BGV homomorphic encryption" OFF)
```

---

## ğŸ“ æ–‡ä»¶å˜æ›´

### ä¿®æ”¹çš„æ ¸å¿ƒæ–‡ä»¶
- `src/crypto/ecc/ecc_curve.cpp` - æ·»åŠ wNAFä¼˜åŒ–å®ç°ï¼ˆ+~130è¡Œï¼‰
- `include/kctsb/crypto/ecc/ecc_curve.h` - æ·»åŠ wNAFç§æœ‰æ–¹æ³•å£°æ˜

### åˆ é™¤çš„ä¼˜åŒ–æ–‡ä»¶ï¼ˆåˆå¹¶åˆ°æ ¸å¿ƒæ–‡ä»¶ï¼‰
- ~~`include/kctsb/crypto/ecc/ecc_optimized.h`~~ â†’ åˆå¹¶åˆ°ecc_curve.h
- ~~`src/crypto/ecc/ecc_optimized.cpp`~~ â†’ åˆå¹¶åˆ°ecc_curve.cpp
- ~~`src/crypto/sm/sm2_optimized.cpp`~~ â†’ å·²åˆ é™¤
- ~~`src/crypto/sm/sm2_fast.cpp`~~ â†’ å·²åˆ é™¤
- ~~`src/crypto/ecc/fe256.cpp`~~ â†’ å·²åˆ é™¤

### BGVç›¸å…³æ–°å¢ï¼ˆå¼€å‘ä¸­ï¼‰
- `include/kctsb/advanced/fe/bgv/bgv.hpp` - BGVä¸»å¤´æ–‡ä»¶
- `include/kctsb/advanced/fe/bgv/bgv_types.hpp` - BGVç±»å‹å®šä¹‰
- `include/kctsb/advanced/fe/bgv/bgv_context.hpp` - BGVä¸Šä¸‹æ–‡
- `include/kctsb/advanced/fe/bgv/bgv_evaluator.hpp` - BGVè¯„ä¼°å™¨
- `include/kctsb/advanced/fe/bgv/bgv_encoder.hpp` - BGVç¼–ç å™¨
- `src/advanced/fe/bgv/bgv_context.cpp` - BGVä¸Šä¸‹æ–‡å®ç° (~700è¡Œ)
- `src/advanced/fe/bgv/bgv_evaluator.cpp` - BGVè¯„ä¼°å™¨å®ç° (~500è¡Œ)
- `src/advanced/fe/bgv/bgv_encoder.cpp` - BGVç¼–ç å™¨å®ç° (~300è¡Œ)

### æµ‹è¯•/åŸºå‡†
- `tests/test_bgv.cpp` - BGVå•å…ƒæµ‹è¯•
- `benchmarks/benchmark_bgv.cpp` - BGVæ€§èƒ½åŸºå‡†

### æ–‡æ¡£
- `docs/homomorphic-encryption-analysis.md` - SEAL vs HElibå¯¹æ¯”åˆ†æ
- `docs/homomorphic-encryption-roadmap.md` - kctsb FHEå®ç°è·¯çº¿å›¾

---

## ğŸ“Š æµ‹è¯•çŠ¶æ€

```
âœ… 169/169 å•å…ƒæµ‹è¯•é€šè¿‡
âœ… 22/22 SMç³»åˆ—æµ‹è¯•é€šè¿‡ (SM2/SM3/SM4)
âœ… ECC wNAFä¼˜åŒ–é›†æˆå®Œæˆï¼Œæ€§èƒ½æå‡~2x
âœ… ä»£ç æ•´åˆï¼šåˆ é™¤4ä¸ªå†—ä½™ä¼˜åŒ–æ–‡ä»¶ï¼Œåˆå¹¶åˆ°æ ¸å¿ƒecc_curve.cpp
âš ï¸ BGVæ¨¡å—æš‚æ—¶ç¦ç”¨ï¼ˆå¾…APIå…¼å®¹æ€§ä¿®å¤ï¼‰
```

---

## ğŸ”® åç»­è®¡åˆ’

1. **BGV APIå…¼å®¹æ€§ä¿®å¤** - é€‚é…kctsb bignumå‘½åç©ºé—´
2. **SM2 wNAFä¼˜åŒ–** - å°†wNAFæŠ€æœ¯åº”ç”¨äºå›½å¯†SM2æ›²çº¿
3. **NTTä¼˜åŒ–** - æ·»åŠ æ•°è®ºå˜æ¢åŠ é€Ÿå¤šé¡¹å¼ä¹˜æ³•
4. **AVX2/AVX-512 SIMD** - BGVæ‰¹å¤„ç†è¿ç®—å‘é‡åŒ–

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [åŒæ€åŠ å¯†åˆ†æ](../homomorphic-encryption-analysis.md)
- [FHEå®ç°è·¯çº¿å›¾](../homomorphic-encryption-roadmap.md)

---

## âš ï¸ å·²çŸ¥é—®é¢˜

1. **BGVæ¨¡å—æš‚æ—¶ç¦ç”¨**: éœ€è¦ä¿®å¤kctsb bignum APIä¸NTLçš„å‘½åç©ºé—´å·®å¼‚
   - `NTL::` â†’ `kctsb::`
   - `uint64_t` â†’ `unsigned long` è½¬æ¢
   - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨è¾…åŠ©å‡½æ•° `to_ZZ(uint64_t)`

2. **ECC/SM2 Benchmarkæœªå®ç°**: benchmarkæ¡†æ¶å·²å°±ä½ï¼Œå…·ä½“æµ‹è¯•ç”¨ä¾‹å¾…è¡¥å……

---

## ğŸ“ å‡çº§æŒ‡å—

ä»v4.1.xå‡çº§ï¼š

```powershell
# é‡æ–°é…ç½®ï¼ˆBGVé»˜è®¤å…³é—­ï¼‰
cmake -B build -G Ninja \
    -DCMAKE_BUILD_TYPE=Release \
    -DKCTSB_BUILD_TESTS=ON \
    -DKCTSB_BUILD_BENCHMARKS=ON

# å¯é€‰ï¼šå¯ç”¨BGVï¼ˆå¼€å‘ä¸­ï¼‰
# cmake ... -DKCTSB_ENABLE_BGV=ON

# ç¼–è¯‘
cmake --build build --parallel
```

---

**å®Œæ•´å˜æ›´æ—¥å¿—**: https://github.com/knightc/kctsb/compare/v4.1.0...v4.2.0

# .clangd configuration for kctsb project
# This file configures clangd language server to properly resolve includes

If:
  PathMatch: .*

CompileFlags:
  CompilationDatabase: .  # Path to compile_commands.json (project root)
  Add:
    # Include paths (relative to project root)
    - -Iinclude
    - -Ithirdparty/include
    - -std=c++17
    # Project defines
    - -DKCTSB_BUILDING
    # Windows platform defines (for NTL config.h conditional compilation)
    - -D_WIN32
    - -D_WIN64
  Remove:
    # Remove platform-specific flags that cause cross-platform issues
    - -fPIC
    - -fPIE
    - -fpic
    - -fpie
    - -march=native
    - -mtune=native
    # Remove flags that may not be recognized by clangd
    - -Wno-*
    - -fno-*

Diagnostics:
  Suppress:
    # Suppress environment-related warnings
    - drv_unsupported_opt_for_target   # -fPIC not supported on Windows
    - pp_file_not_found                # Missing headers from external deps
    - undeclared_var_use               # OpenSSL symbols not found by clangd
    - unused-includes
    - misc-definitions-in-headers
    # Suppress warnings about missing external dependencies
    - module_file_not_found
    - fatal_too_many_errors
  UnusedIncludes: None
  ClangTidy:
    Remove:
      # Exclude checks that generate noise from thirdparty code
      - modernize-*
      - readability-identifier-naming
      - misc-use-internal-linkage

Index:
  Background: Build
  StandardLibrary: Yes

---
# Exclude thirdparty directory from diagnostics
If:
  PathMatch: .*/thirdparty/.*

Diagnostics:
  Suppress: '*'
  ClangTidy:
    Remove: '*'

---
# Exclude benchmarks from strict clang-tidy checks
If:
  PathMatch: .*/benchmarks/.*

Diagnostics:
  Suppress:
    - pp_file_not_found
    - undeclared_var_use
    - drv_unsupported_opt_for_target
  ClangTidy:
    Remove:
      - misc-use-internal-linkage
      - readability-identifier-naming
      - performance-avoid-endl
      - modernize-*

---
# Exclude tests from strict clang-tidy checks
If:
  PathMatch: .*/tests/.*

Diagnostics:
  ClangTidy:
    Remove:
      - misc-use-internal-linkage
      - readability-identifier-naming
      - modernize-*
